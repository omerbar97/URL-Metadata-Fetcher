import * as express from 'express';
import Route from './route';

export default class Server {
  app:express.Application;

  route:Route;

  constructor() {
    this.app = express();

    this.route = new Route('/', 'index');
  }

  public listen(callback?) {
    this.setup();

    this.app.listen(3000, callback);
  }

  private setup() {
    const addRoute = ((route, pathPrefix = '') => {
      const path = pathPrefix + route.path;

      if (route.post) {
        this.app.post(path, route.post);
      } else if (route.get) {
        this.app.get(path, route.get);
      }

      route.children.map(((collectable, route) => {
        addRoute.call(this, route, path);
      }).bind(this));
    }).bind(this);

    addRoute(this.route);
  }
}

export { Server };
